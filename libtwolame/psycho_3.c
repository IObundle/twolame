/*
 *  TwoLAME: an optimized MPEG Audio Layer Two encoder
 *
 *  Copyright (C) 2001-2004 Michael Cheng
 *  Copyright (C) 2004-2018 The TwoLAME Project
 *  Copyright (C) 2023 IObundle, Lda
 *
 *  This library is free software; you can redistribute it and/or
 *  modify it under the terms of the GNU Lesser General Public
 *  License as published by the Free Software Foundation; either
 *  version 2.1 of the License, or (at your option) any later version.
 *
 *  This library is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 *  Lesser General Public License for more details.
 *
 *  You should have received a copy of the GNU Lesser General Public
 *  License along with this library; if not, write to the Free Software
 *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 *
 */

//#include <stdio.h>
#include "printf.h"
#include <stdlib.h>
#include <math.h>
#include <string.h>

#include "twolame.h"
#include "common.h"
#include "mem.h"
#include "fft.h"
#include "ath.h"
#include "psycho_3.h"

#include "iob-timer.h"

//profiling psycho_3
unsigned int start_elapse_time_psycho_3;
unsigned int end_elapse_time_psycho_3;
unsigned int elapsed_time_psycho_3[50];

//log10 substitution table
//static double tablog10[] = {-4.0, -4.0, -3.698970004, -3.522878745, -3.397940009, -3.301029996, -3.22184875, -3.15490196, -3.096910013, -3.045757491, -3.0, -2.958607315, -2.920818754, -2.886056648, -2.853871964, -2.823908741, -2.795880017, -2.769551079, -2.744727495, -2.721246399, -2.698970004, -2.677780705, -2.657577319, -2.638272164, -2.619788758, -2.602059991, -2.585026652, -2.568636236, -2.552841969, -2.537602002, -2.522878745, -2.508638306, -2.494850022, -2.48148606, -2.468521083, -2.455931956, -2.443697499, -2.431798276, -2.420216403, -2.408935393, -2.397940009, -2.387216143, -2.37675071, -2.366531544, -2.356547324, -2.346787486, -2.337242168, -2.327902142, -2.318758763, -2.30980392, -2.301029996, -2.292429824, -2.283996656, -2.27572413, -2.26760624, -2.259637311, -2.251811973, -2.244125144, -2.236572006, -2.229147988, -2.22184875, -2.214670165, -2.207608311, -2.200659451, -2.193820026, -2.187086643, -2.180456064, -2.173925197, -2.167491087, -2.161150909, -2.15490196, -2.148741651, -2.142667504, -2.13667714, -2.13076828, -2.124938737, -2.119186408, -2.113509275, -2.107905397, -2.102372909, -2.096910013, -2.091514981, -2.086186148, -2.080921908, -2.075720714, -2.070581074, -2.065501549, -2.060480747, -2.055517328, -2.050609993, -2.045757491, -2.040958608, -2.036212173, -2.031517051, -2.026872146, -2.022276395, -2.017728767, -2.013228266, -2.008773924, -2.004364805, -2.0, -1.995678626, -1.991399828, -1.987162775, -1.982966661, -1.978810701, -1.974694135, -1.970616222, -1.966576245, -1.962573502, -1.958607315, -1.954677021, -1.950781977, -1.946921557, -1.943095149, -1.93930216, -1.935542011, -1.931814138, -1.928117993, -1.924453039, -1.920818754, -1.91721463, -1.913640169, -1.910094889, -1.906578315, -1.903089987, -1.899629455, -1.896196279, -1.89279003, -1.88941029, -1.886056648, -1.882728704, -1.879426069, -1.876148359, -1.872895202, -1.869666232, -1.866461092, -1.863279433, -1.860120914, -1.8569852, -1.853871964, -1.850780887, -1.847711656, -1.844663963, -1.841637508, -1.838631998, -1.835647144, -1.832682665, -1.829738285, -1.826813732, -1.823908741, -1.821023053, -1.818156412, -1.815308569, -1.812479279, -1.809668302, -1.806875402, -1.804100348, -1.801342913, -1.798602876, -1.795880017, -1.793174124, -1.790484985, -1.787812396, -1.785156152, -1.782516056, -1.779891912, -1.777283529, -1.774690718, -1.772113295, -1.769551079, -1.76700389, -1.764471553, -1.761953897, -1.759450752, -1.756961951, -1.754487332, -1.752026734, -1.749579998, -1.747146969, -1.744727495, -1.742321425, -1.739928612, -1.73754891, -1.735182177, -1.732828272, -1.730487056, -1.728158393, -1.725842151, -1.723538196, -1.721246399, -1.718966633, -1.716698771, -1.714442691, -1.71219827, -1.709965389, -1.707743929, -1.705533774, -1.70333481, -1.701146924, -1.698970004, -1.696803943, -1.694648631, -1.692503962, -1.690369833, -1.688246139, -1.68613278, -1.684029655, -1.681936665, -1.679853714, -1.677780705, -1.675717545, -1.673664139, -1.671620397, -1.669586227, -1.66756154, -1.665546249, -1.663540266, -1.661543506, -1.659555885, -1.657577319, -1.655607726, -1.653647026, -1.651695137, -1.649751982, -1.647817482, -1.645891561, -1.643974143, -1.642065153, -1.640164518, -1.638272164, -1.63638802, -1.634512015, -1.632644079, -1.630784143, -1.628932138, -1.627087997, -1.625251654, -1.623423043, -1.621602099, -1.619788758, -1.617982957, -1.616184634, -1.614393726, -1.612610174, -1.610833916, -1.609064893, -1.607303047, -1.605548319, -1.603800653, -1.602059991, -1.600326279, -1.598599459, -1.596879479, -1.595166283, -1.59345982, -1.591760035, -1.590066877, -1.588380294, -1.586700236, -1.585026652, -1.583359493, -1.581698709, -1.580044252, -1.578396073, -1.576754126, -1.575118363, -1.573488739, -1.571865206, -1.57024772, -1.568636236, -1.567030709, -1.565431096, -1.563837353, -1.562249437, -1.560667306, -1.559090918, -1.557520231, -1.555955204, -1.554395797, -1.552841969, -1.55129368, -1.549750892, -1.548213564, -1.54668166, -1.54515514, -1.543633967, -1.542118103, -1.540607512, -1.539102157, -1.537602002, -1.536107011, -1.534617149, -1.53313238, -1.53165267, -1.530177984, -1.528708289, -1.527243551, -1.525783736, -1.524328812, -1.522878745, -1.521433504, -1.519993057, -1.518557371, -1.517126416, -1.515700161, -1.514278574, -1.512861625, -1.511449283, -1.510041521, -1.508638306, -1.507239611, -1.505845406, -1.504455662, -1.503070352, -1.501689446, -1.500312917, -1.498940738, -1.49757288, -1.496209317, -1.494850022, -1.493494968, -1.492144128, -1.490797478, -1.48945499, -1.488116639, -1.4867824, -1.485452247, -1.484126156, -1.482804102, -1.48148606, -1.480172006, -1.478861916, -1.477555766, -1.476253533, -1.474955193, -1.473660723, -1.472370099, -1.4710833, -1.469800302, -1.468521083, -1.467245621, -1.465973894, -1.46470588, -1.463441557, -1.462180905, -1.460923901, -1.459670525, -1.458420756, -1.457174573, -1.455931956, -1.454692884, -1.453457337, -1.452225295, -1.450996738, -1.449771647, -1.448550002, -1.447331784, -1.446116973, -1.444905551, -1.443697499, -1.442492798, -1.441291429, -1.440093375, -1.438898616, -1.437707136, -1.436518915, -1.435333936, -1.434152181, -1.432973634, -1.431798276, -1.43062609, -1.42945706, -1.428291168, -1.427128398, -1.425968732, -1.424812155, -1.42365865, -1.4225082, -1.42136079, -1.420216403, -1.419075024, -1.417936637, -1.416801226, -1.415668776, -1.41453927, -1.413412695, -1.412289035, -1.411168274, -1.410050399, -1.408935393, -1.407823243, -1.406713933, -1.40560745, -1.404503778, -1.403402904, -1.402304814, -1.401209493, -1.400116928, -1.399027104, -1.397940009, -1.396855627, -1.395773947, -1.394694954, -1.393618635, -1.392544977, -1.391473966, -1.390405591, -1.389339837, -1.388276692, -1.387216143, -1.386158178, -1.385102784, -1.384049948, -1.382999659, -1.381951903, -1.380906669, -1.379863945, -1.378823718, -1.377785977, -1.37675071, -1.375717904, -1.374687549, -1.373659633, -1.372634143, -1.37161107, -1.370590401, -1.369572125, -1.368556231, -1.367542708, -1.366531544, -1.36552273, -1.364516253, -1.363512104, -1.36251027, -1.361510743, -1.360513511, -1.359518563, -1.358525889, -1.35753548, -1.356547324, -1.355561411, -1.354577731, -1.353596274, -1.35261703, -1.351639989, -1.350665141, -1.349692477, -1.348721986, -1.347753659, -1.346787486, -1.345823458, -1.344861565, -1.343901798, -1.342944147, -1.341988603, -1.341035157, -1.3400838, -1.339134522, -1.338187314, -1.337242168, -1.336299075, -1.335358024, -1.334419009, -1.333482019, -1.332547047, -1.331614083, -1.330683119, -1.329754147, -1.328827157, -1.327902142, -1.326979093, -1.326058001, -1.325138859, -1.324221658, -1.32330639, -1.322393047, -1.321481621, -1.320572103, -1.319664487, -1.318758763, -1.317854924, -1.316952962, -1.316052869, -1.315154638, -1.314258261, -1.313363731, -1.312471039, -1.311580178, -1.310691141, -1.30980392, -1.308918508, -1.308034897, -1.307153081, -1.306273051, -1.305394801, -1.304518324, -1.303643611, -1.302770657, -1.301899454, -1.301029996, -1.300162274, -1.299296283, -1.298432015, -1.297569464, -1.296708622, -1.295849483, -1.294992041, -1.294136288, -1.293282218, -1.292429824, -1.2915791, -1.290730039};
static double tablog10_psycho_3_powerdensityspectrum[] = {-40, -40, -36.98970004, -35.22878745, -33.97940009, -33.01029996, -32.2184875, -31.5490196, 
                -30.96910013, -30.45757491, -30, -29.58607315, -29.20818754, -28.86056648, -28.53871964, 
                -28.23908741, -27.95880017, -27.69551079, -27.44727495, -27.21246399, -26.98970004, 
                -26.77780705, -26.57577319, -26.38272164, -26.19788758, -26.02059991, -25.85026652, 
                -25.68636236, -25.52841969, -25.37602002, -25.22878745, -25.08638306, -24.94850022, 
                -24.8148606, -24.68521083, -24.55931956, -24.43697499, -24.31798276, -24.20216403, 
                -24.08935393, -23.97940009, -23.87216143, -23.7675071, -23.66531544, -23.56547324, 
                -23.46787486, -23.37242168, -23.27902142, -23.18758763, -23.0980392, -23.01029996, 
                -22.92429824, -22.83996656, -22.7572413, -22.6760624, -22.59637311, -22.51811973, 
                -22.44125144, -22.36572006, -22.29147988, -22.2184875, -22.14670165, -22.07608311, 
                -22.00659451, -21.93820026, -21.87086643, -21.80456064, -21.73925197, -21.67491087, 
                -21.61150909, -21.5490196, -21.48741651, -21.42667504, -21.3667714, -21.3076828, 
                -21.24938737, -21.19186408, -21.13509275, -21.07905397, -21.02372909, -20.96910013, 
                -20.91514981, -20.86186148, -20.80921908, -20.75720714, -20.70581074, -20.65501549, 
                -20.60480747, -20.55517328, -20.50609993, -20.45757491, -20.40958608, -20.36212173, 
                -20.31517051, -20.26872146, -20.22276395, -20.17728767, -20.13228266, -20.08773924, 
                -20.04364805, -20, -19.95678626, -19.91399828, -19.87162775, -19.82966661, -19.78810701, -19.74694135,
                -19.70616222, -19.66576245, -19.62573502, -19.58607315, -19.54677021,
                -19.50781977, -19.46921557, -19.43095149, -19.3930216, -19.35542011,
                -19.31814138, -19.28117993, -19.24453039, -19.20818754, -19.1721463,
                -19.13640169, -19.10094889, -19.06578315, -19.03089987, -18.99629455,
                -18.96196279, -18.9279003, -18.8941029, -18.86056648, -18.82728704,
                -18.79426069, -18.76148359, -18.72895202, -18.69666232, -18.66461092,
                -18.63279433, -18.60120914, -18.569852, -18.53871964, -18.50780887,
                -18.47711656, -18.44663963, -18.41637508, -18.38631998, -18.35647144,
                -18.32682665, -18.29738285, -18.26813732, -18.23908741, -18.21023053,
                -18.18156412, -18.15308569, -18.12479279, -18.09668302, -18.06875402,
                -18.04100348, -18.01342913, -17.98602876, -17.95880017, -17.93174124,
                -17.90484985, -17.87812396, -17.85156152, -17.82516056, -17.79891912,
                -17.77283529, -17.74690718, -17.72113295, -17.69551079, -17.6700389,
                -17.64471553, -17.61953897, -17.59450752, -17.56961951, -17.54487332,
                -17.52026734, -17.49579998, -17.47146969, -17.44727495, -17.42321425,
                -17.39928612, -17.3754891, -17.35182177, -17.32828272, -17.30487056,
                -17.28158393, -17.25842151, -17.23538196, -17.21246399, -17.18966633,
                -17.16698771, -17.14442691, -17.1219827, -17.09965389, -17.07743929,
                -17.05533774, -17.0333481, -17.01146924, -16.98970004, -16.96803943, 
                -16.94648631, -16.92503962, -16.90369833, -16.88246139, -16.8613278, -16.84029655, -16.81936665, -16.79853714, -16.77780705, -16.75717545, -16.73664139, -16.71620397, -16.69586227, -16.6756154, -16.65546249, -16.63540266, -16.61543506, -16.59555885, -16.57577319, -16.55607726, -16.53647026, -16.51695137, -16.49751982, -16.47817482, -16.45891561, -16.43974143, -16.42065153, -16.40164518, -16.38272164, -16.3638802, -16.34512015, -16.32644079, -16.30784143, -16.28932138, -16.27087997, -16.25251654, -16.23423043, -16.21602099, -16.19788758, -16.17982957, -16.16184634, -16.14393726, -16.12610174, -16.10833916, -16.09064893, -16.07303047, -16.05548319, -16.03800653, -16.02059991, -16.00326279, -15.98599459, -15.96879479, -15.95166283, -15.9345982, -15.91760035, -15.90066877, -15.88380294, -15.86700236, -15.85026652, -15.83359493, -15.81698709, -15.80044252, -15.78396073, -15.76754126, -15.75118363, -15.73488739, -15.71865206, -15.7024772, -15.68636236, -15.67030709, -15.65431096, -15.63837353, -15.62249437, -15.60667306, -15.59090918, -15.57520231, -15.55955204, -15.54395797, -15.52841969, -15.5129368, -15.49750892, -15.48213564, -15.4668166, -15.4515514, -15.43633967, -15.42118103, -15.40607512, -15.39102157, -15.37602002, -15.36107011, -15.34617149, -15.3313238, -15.3165267, -15.30177984, -15.28708289, -15.27243551, -15.25783736, -15.24328812, -15.22878745, -15.21433504, -15.19993057, -15.18557371, -15.17126416, -15.15700161, -15.14278574, -15.12861625, -15.11449283, -15.10041521, -15.08638306, -15.07239611, -15.05845406, -15.04455662, -15.03070352, -15.01689446, -15.00312917, -14.98940738, -14.9757288, -14.96209317, -14.94850022, -14.93494968, -14.92144128, -14.90797478, -14.8945499, -14.88116639, -14.867824, -14.85452247, -14.84126156, -14.82804102, -14.8148606, -14.80172006, -14.78861916, -14.77555766, -14.76253533, -14.74955193, -14.73660723, -14.72370099, -14.710833, -14.69800302, -14.68521083, -14.67245621, -14.65973894, -14.6470588, -14.63441557, -14.62180905, -14.60923901, -14.59670525, -14.58420756, -14.57174573, -14.55931956, -14.54692884, -14.53457337, -14.52225295, -14.50996738, -14.49771647, -14.48550002, -14.47331784, -14.46116973, -14.44905551, -14.43697499, -14.42492798, -14.41291429, -14.40093375, -14.38898616, -14.37707136, -14.36518915, -14.35333936, -14.34152181, -14.32973634, -14.31798276, -14.3062609, -14.2945706, -14.28291168, -14.27128398, -14.25968732, -14.24812155, -14.2365865, -14.225082, -14.2136079, -14.20216403, -14.19075024, -14.17936637, -14.16801226, -14.15668776, -14.1453927, -14.13412695, -14.12289035, -14.11168274, -14.10050399, -14.08935393, -14.07823243, -14.06713933, -14.0560745, -14.04503778, -14.03402904, -14.02304814, -14.01209493, -14.00116928, -13.99027104, -13.97940009, -13.96855627, -13.95773947, -13.94694954, -13.93618635, -13.92544977, -13.91473966, -13.90405591, -13.89339837, -13.88276692, -13.87216143, -13.86158178, -13.85102784, -13.84049948, -13.82999659, -13.81951903, -13.80906669, -13.79863945, -13.78823718, -13.77785977, -13.7675071, -13.75717904, -13.74687549, -13.73659633, -13.72634143, -13.7161107, -13.70590401, -13.69572125, -13.68556231, -13.67542708, -13.66531544, -13.6552273, -13.64516253, -13.63512104, -13.6251027, -13.61510743, -13.60513511, -13.59518563, -13.58525889, -13.5753548, -13.56547324, -13.55561411, -13.54577731, -13.53596274, -13.5261703, -13.51639989, -13.50665141, -13.49692477, -13.48721986, -13.47753659, -13.46787486, -13.45823458, -13.44861565, -13.43901798, -13.42944147, -13.41988603, -13.41035157, -13.400838, -13.39134522, -13.38187314, -13.37242168, -13.36299075, -13.35358024, -13.34419009, -13.33482019, -13.32547047, -13.31614083, -13.30683119, -13.29754147, -13.28827157, -13.27902142, -13.26979093, -13.26058001, -13.25138859, -13.24221658, -13.2330639, -13.22393047, -13.21481621, -13.20572103, -13.19664487, -13.18758763, -13.17854924, -13.16952962, -13.16052869, -13.15154638, -13.14258261, -13.13363731, -13.12471039, -13.11580178, -13.10691141, -13.0980392, -13.08918508, -13.08034897, -13.07153081, -13.06273051, -13.05394801, -13.04518324, -13.03643611, -13.02770657, -13.01899454, -13.01029996, -13.00162274, -12.99296283, -12.98432015, -12.97569464, -12.96708622, -12.95849483, -12.94992041, -12.94136288, -12.93282218, -12.92429824, -12.915791
};

static double tablog10_psycho_3_init_add_db[] = {3.010300, 2.960588, 2.911451, 2.862890, 2.814903, 2.767492, 2.720653, 2.674388, 2.628695, 2.583572, 2.539019, 2.495034, 2.451615, 2.408762, 2.366471, 2.324741, 2.283570, 2.242955, 2.202895, 2.163386, 2.124426, 2.086012, 2.048142, 2.010812, 1.974018, 1.937759, 1.902030, 1.866828, 1.832150, 1.797991, 1.764349, 1.731218, 1.698595, 1.666477, 1.634858, 1.603736, 1.573104, 1.542960, 1.513298, 1.484115, 1.455405, 1.427164, 1.399387, 1.372070, 1.345207, 1.318795, 1.292827, 1.267300, 1.242208, 1.217547, 1.193310, 1.169495, 1.146094, 1.123103, 1.100518, 1.078332, 1.056542, 1.035141, 1.014126, 0.993490, 0.973228, 0.953336, 0.933808, 0.914640, 0.895825, 0.877360, 0.859240, 0.841458, 0.824010, 0.806892, 0.790097, 0.773623, 0.757462, 0.741611, 0.726065, 0.710819, 0.695867, 0.681207, 0.666832, 0.652738, 0.638920, 0.625375, 0.612097, 0.599082, 0.586325, 0.573822, 0.561569, 0.549562, 0.537795, 0.526266, 0.514969, 0.503901, 0.493058, 0.482435, 0.472029, 0.461836, 0.451852, 0.442072, 0.432494, 0.423114, 0.413927, 
                0.404930, 0.396121, 0.387494, 0.379048, 0.370778, 0.362680, 0.354753, 0.346992, 0.339394, 0.331956, 0.324675, 0.317549, 0.310573, 0.303745, 0.297062, 0.290521, 0.284119, 0.277855, 0.271724, 0.265724, 0.259852, 0.254107, 0.248485, 0.242984, 0.237602, 0.232336, 0.227183, 0.222142, 0.217209, 0.212384, 0.207663, 0.203045, 0.198527, 0.194108, 0.189784, 0.185555, 0.181419, 0.177372, 0.173414, 0.169543, 0.165756, 0.162053, 0.158430, 0.154888, 0.151423, 0.148034, 0.144720, 0.141479, 0.138309, 0.135209, 0.132178, 0.129213, 0.126315, 0.123480, 0.120708, 0.117997, 0.115346, 0.112755, 0.110220, 0.107742, 0.105319, 0.102950, 0.100634, 0.098369, 0.096154, 0.093989, 0.091872, 0.089802, 0.087778, 0.085800, 0.083866, 0.081975, 0.080126, 0.078318, 0.076551, 0.074823, 0.073135, 0.071483, 0.069869, 0.068291, 0.066749, 0.065241, 0.063766, 0.062325, 0.060916, 0.059539, 0.058193, 0.056877, 0.055591, 0.054333, 0.053104, 0.051902, 0.050728, 0.049580, 0.048457, 0.047360, 0.046288, 0.045240, 0.044215, 0.043214, 
                0.042235, 0.041278, 0.040343, 0.039429, 0.038535, 0.037662, 0.036808, 0.035974, 0.035158, 0.034361, 0.033582, 0.032820, 0.032076, 0.031348, 0.030637, 0.029942, 0.029263, 0.028599, 0.027950, 0.027316, 0.026696, 0.026090, 0.025498, 0.024919, 0.024354, 0.023801, 0.023261, 0.022733, 0.022216, 0.021712, 0.021219, 0.020737, 0.020266, 0.019806, 0.019356, 0.018916, 0.018487, 0.018067, 0.017656, 0.017255, 0.016863, 0.016480, 0.016106, 0.015740, 0.015382, 0.015033, 0.014691, 0.014357, 0.014031, 0.013712, 0.013400, 0.013096, 0.012798, 0.012507, 0.012223, 0.011945, 0.011673, 0.011408, 0.011149, 0.010895, 0.010648, 0.010406, 0.010169, 0.009938, 0.009712, 0.009491, 0.009275, 0.009064, 0.008858, 0.008657, 0.008460, 0.008267, 0.008079, 0.007896, 0.007716, 0.007541, 0.007369, 0.007202, 0.007038, 0.006878, 0.006721, 0.006568, 0.006419, 0.006273, 0.006130, 0.005991, 0.005855, 0.005721, 0.005591, 0.005464, 0.005340, 0.005218, 0.005100, 0.004984, 0.004870, 0.004759, 0.004651, 0.004545, 0.004442, 0.004341, 
                0.004242, 0.004146, 0.004051, 0.003959, 0.003869, 0.003781, 0.003695, 0.003611, 0.003529, 0.003448, 0.003370, 0.003293, 0.003218, 0.003145, 0.003073, 0.003004, 0.002935, 0.002868, 0.002803, 0.002739, 0.002677, 0.002616, 0.002557, 0.002498, 0.002442, 0.002386, 0.002332, 0.002279, 0.002227, 0.002176, 0.002127, 0.002078, 0.002031, 0.001985, 0.001939, 0.001895, 0.001852, 0.001810, 0.001769, 0.001729, 0.001689, 0.001651, 0.001613, 0.001577, 0.001541, 0.001506, 0.001471, 0.001438, 0.001405, 0.001373, 0.001342, 0.001311, 0.001282, 0.001252, 0.001224, 0.001196, 0.001169, 0.001142, 0.001116, 0.001091, 0.001066, 0.001042, 0.001018, 0.000995, 0.000972, 0.000950, 0.000928, 0.000907, 0.000887, 0.000866, 0.000847, 0.000827, 0.000809, 0.000790, 0.000772, 0.000755, 0.000737, 0.000721, 0.000704, 0.000688, 0.000673, 0.000657, 0.000642, 0.000628, 0.000613, 0.000599, 0.000586, 0.000572, 0.000559, 0.000547, 0.000534, 0.000522, 0.000510, 0.000499, 0.000487, 0.000476, 0.000465, 0.000455, 0.000444, 0.000434, 
                0.000424, 0.000415, 0.000405, 0.000396, 0.000387, 0.000378, 0.000370, 0.000361, 0.000353, 0.000345, 0.000337, 0.000329, 0.000322, 0.000315, 0.000307, 0.000300, 0.000294, 0.000287, 0.000280, 0.000274, 0.000268, 0.000262, 0.000256, 0.000250, 0.000244, 0.000239, 0.000233, 0.000228, 0.000223, 0.000218, 0.000213, 0.000208, 0.000203, 0.000199, 0.000194, 0.000190, 0.000185, 0.000181, 0.000177, 0.000173, 0.000169, 0.000165, 0.000161, 0.000158, 0.000154, 0.000151, 0.000147, 0.000144, 0.000141, 0.000137, 0.000134, 0.000131, 0.000128, 0.000125, 0.000122, 0.000120, 0.000117, 0.000114, 0.000112, 0.000109, 0.000107, 0.000104, 0.000102, 0.000099, 0.000097, 0.000095, 0.000093, 0.000091, 0.000089, 0.000087, 0.000085, 0.000083, 0.000081, 0.000079, 0.000077, 0.000075, 0.000074, 0.000072, 0.000070, 0.000069, 0.000067, 0.000066, 0.000064, 0.000063, 0.000061, 0.000060, 0.000059, 0.000057, 0.000056, 0.000055, 0.000053, 0.000052, 0.000051, 0.000050, 0.000049, 0.000048, 0.000047, 0.000045, 0.000044, 0.000043, 
                0.000042, 0.000041, 0.000041, 0.000040, 0.000039, 0.000038, 0.000037, 0.000036, 0.000035, 0.000034, 0.000034, 0.000033, 0.000032, 0.000031, 0.000031, 0.000030, 0.000029, 0.000029, 0.000028, 0.000027, 0.000027, 0.000026, 0.000026, 0.000025, 0.000024, 0.000024, 0.000023, 0.000023, 0.000022, 0.000022, 0.000021, 0.000021, 0.000020, 0.000020, 0.000019, 0.000019, 0.000019, 0.000018, 0.000018, 0.000017, 0.000017, 0.000017, 0.000016, 0.000016, 0.000015, 0.000015, 0.000015, 0.000014, 0.000014, 0.000014, 0.000013, 0.000013, 0.000013, 0.000013, 0.000012, 0.000012, 0.000012, 0.000011, 0.000011, 0.000011, 0.000011, 0.000010, 0.000010, 0.000010, 0.000010, 0.000010, 0.000009, 0.000009, 0.000009, 0.000009, 0.000008, 0.000008, 0.000008, 0.000008, 0.000008, 0.000008, 0.000007, 0.000007, 0.000007, 0.000007, 0.000007, 0.000007, 0.000006, 0.000006, 0.000006, 0.000006, 0.000006, 0.000006, 0.000006, 0.000005, 0.000005, 0.000005, 0.000005, 0.000005, 0.000005, 0.000005, 0.000005, 0.000005, 0.000004, 0.000004, 
                0.000004, 0.000004, 0.000004, 0.000004, 0.000004, 0.000004, 0.000004, 0.000004, 0.000004, 0.000003, 0.000003, 0.000003, 0.000003, 0.000003, 0.000003, 0.000003, 0.000003, 0.000003, 0.000003, 0.000003, 0.000003, 0.000003, 0.000003, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000002, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 
                0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 
                0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000,
                0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000
};

static double tablog10_psycho_3_spl[] = {0.0, 10.000000, 16.020599, 19.542425, 22.041201, 23.979401, 25.563025, 26.901960, 28.061800, 29.084850, 30.000000, 30.827854, 31.583626, 32.278866, 32.922562, 33.521824, 34.082401, 34.608978, 35.105450, 35.575073, 36.020599, 36.444386, 36.848454, 37.234558, 37.604225, 37.958801, 38.299465, 38.627274, 38.943161, 39.247959, 39.542423, 39.827232, 40.103001, 40.370277, 40.629578, 40.881359, 41.126049, 41.364033, 41.595673, 41.821293, 42.041199, 42.255676, 42.464985, 42.669369, 42.869053, 43.064251, 43.255157, 43.441956, 43.624825, 43.803921, 43.979401, 44.151405, 44.320068, 44.485516, 44.647877, 44.807255, 44.963760, 45.117496, 45.268559, 45.417042, 45.563026, 45.706596, 45.847836, 45.986813, 46.123600, 46.258266, 46.390881, 46.521496, 46.650177, 46.776981, 46.901962, 47.025166, 47.146648, 47.266457, 47.384636, 47.501225, 47.616272, 47.729813, 47.841892, 47.952541, 48.061798, 48.169701, 48.276276, 48.381561, 48.485584, 48.588379, 48.689968, 48.790386, 48.889652, 48.987801, 49.084850, 49.180828, 49.275757, 49.369659, 49.462559, 49.554474, 49.645424, 49.735435, 49.824520, 49.912704, 50.000000, 50.086426, 50.172005, 50.256744, 50.340668, 50.423786, 50.506119, 50.587677, 50.668476, 50.748531, 50.827854, 50.906460, 50.984360, 51.061569, 51.138096, 51.213955, 51.289162, 51.363716, 51.437641, 51.510941, 51.583626, 51.655708, 51.727196, 51.798103, 51.868435, 51.938202, 52.007412, 52.076073, 52.144199, 52.211796, 52.278866, 52.345425, 52.411480, 52.477032, 52.542095, 52.606674, 52.670776, 52.734413, 52.797581, 52.860294, 52.922562, 52.984383, 53.045769, 53.106720, 53.167252, 53.227360, 53.287056, 53.346348, 53.405235, 53.463726, 53.521824, 53.579540, 53.636871, 53.693829, 53.750416, 53.806633, 53.862492, 53.917992, 53.973141, 54.027943, 54.082401, 54.136517, 54.190300, 54.243752, 54.296879, 54.349678, 54.402161, 54.454330, 54.506187, 54.557735, 54.608978, 54.659924, 54.710567, 54.760921, 54.810986, 54.860760, 54.910252, 54.959465, 55.008400, 55.057060, 55.105450, 55.153572, 55.201427, 55.249023, 55.296356, 55.343433, 55.390259, 55.436832, 55.483158, 55.529236, 55.575073, 55.620667, 55.666023, 55.711147, 55.756035, 55.800694, 55.845123, 55.889324, 55.933304, 55.977062, 56.020599, 56.063923, 56.107029, 56.149921, 56.192604, 56.235077, 56.277344, 56.319408, 56.361267, 56.402927, 56.444386, 56.485649, 56.526718, 56.567593, 56.608276, 56.648769, 56.689075, 56.729195, 56.769131, 56.808884, 56.848454, 56.887844, 56.927059, 56.966099, 57.004959, 57.043652, 57.082169, 57.120518, 57.158695, 57.196709, 57.234558, 57.272240, 57.309761, 57.347118, 57.384315, 57.421356, 57.458241, 57.494968, 57.531540, 57.567959, 57.604225, 57.640343, 57.676308, 57.712124, 57.747795, 57.783321, 57.818703, 57.853939, 57.889034, 57.923988, 57.958801, 57.993473, 58.028011, 58.062412, 58.096676, 58.130802, 58.164799, 58.198662, 58.232395, 58.265995, 58.299465, 58.332809, 58.366024, 58.399117, 58.432079, 58.464916, 58.497631, 58.530224, 58.562695, 58.595047, 58.627274, 58.659386, 58.691380, 58.723251, 58.755013, 58.786655, 58.818180, 58.849594, 58.880898, 58.912083, 58.943161, 58.974125, 59.004982, 59.035728, 59.066368, 59.096897, 59.127319, 59.157639, 59.187851, 59.217957, 59.247959, 59.277859, 59.307655, 59.337353, 59.366947, 59.396439, 59.425835, 59.455128, 59.484325, 59.513424, 59.542423, 59.571331, 59.600140, 59.628853, 59.657471, 59.685997, 59.714428, 59.742767, 59.771015, 59.799171, 59.827232, 59.855209, 59.883091, 59.910885, 59.938595, 59.966209, 59.993740, 60.021187, 60.048542, 60.075813, 60.103001, 60.130100, 60.157116, 60.184052, 60.210899, 60.237667, 60.264351, 60.290955, 60.317478, 60.343918, 60.370277, 60.396561, 60.422760, 60.448883, 60.474930, 60.500896, 60.526787, 60.552597, 60.578335, 60.603992, 60.629578, 60.655087, 60.680523, 60.705883, 60.731171, 60.756382, 60.781521, 60.806591, 60.831585, 60.856510, 60.881359, 60.906143, 60.930855, 60.955494, 60.980064, 61.004566, 61.028999, 61.053364, 61.077660, 61.101891, 61.126049, 61.150143, 61.174171, 61.198132, 61.222027, 61.245857, 61.269623, 61.293320, 61.316956, 61.340527, 61.364033, 61.387478, 61.410858, 61.434177, 61.457432, 61.480625, 61.503757, 61.526829, 61.549835, 61.572784, 61.595673, 61.618500, 61.641266, 61.663975, 61.686623, 61.709213, 61.731747, 61.754219, 61.776634, 
                61.798992, 61.821293, 61.843536, 61.865723, 61.887852, 61.909924, 61.931942, 61.953903, 61.975811, 61.997662, 62.019459, 62.041199, 62.062889, 62.084522, 62.106102, 62.127628, 62.149101, 62.170521, 62.191887, 62.213203, 62.234467, 62.255676, 62.276836, 62.297943, 62.319000, 62.340008, 62.360962, 62.381866, 62.402721, 62.423527, 62.444279, 62.464985, 62.485641, 62.506248, 62.526806, 62.547318, 62.567780, 62.588192, 62.608559, 62.628876, 62.649147, 62.669369, 62.689545, 62.709675, 62.729759, 62.749794, 62.769787, 62.789730, 62.809628, 62.829483, 62.849289, 62.869053, 62.888771, 62.908447, 62.928074, 62.947659, 62.967201, 62.986698, 63.006149, 63.025558, 63.044926, 63.064251, 63.083530, 63.102768, 63.121964, 63.141117, 63.160229, 63.179298, 63.198322, 63.217308, 63.236252, 63.255157, 63.274017, 63.292839, 63.311619, 63.330360, 63.349060, 63.367718, 63.386337, 63.404919, 63.423458, 63.441956, 63.460419, 63.478840, 63.497223, 63.515568, 63.533871, 63.552139, 63.570366, 63.588558, 63.606709, 63.624825, 63.642902, 63.660942, 63.678944, 63.696907, 63.714836, 63.732727, 63.750580, 63.768398, 63.786179, 63.803921, 63.821629, 63.839302, 63.856937, 63.874538, 63.892105, 63.909634, 63.927128, 63.944588, 63.962009, 63.979401, 63.996754, 64.014076, 64.031357, 64.048615, 64.065826, 64.083008, 64.100159, 64.117271, 64.134354, 64.151405, 64.168419, 64.185402, 64.202347, 64.219261, 64.236145, 64.252991, 64.269814, 64.286598, 64.303345, 64.320068, 64.336754, 64.353409, 64.370033, 64.386627, 64.403183, 64.419716, 64.436211, 64.452675, 64.469116, 64.485519, 64.501892, 64.518234, 64.534546, 64.550827, 64.567078, 64.583298, 64.599487, 64.615646, 64.631775, 64.647873, 64.663948, 64.679985, 64.695999, 64.711975, 64.727928, 64.743851, 64.759743, 64.775612, 64.791451, 64.807251, 64.823029, 64.838783, 64.854500, 64.870193, 64.885857, 64.901497, 64.917107, 64.932686, 64.948235, 64.963760, 64.979256, 64.994728, 65.010170, 65.025581, 65.040970, 65.056328, 65.071663, 65.086967, 65.102242, 65.117500, 65.132721, 65.147919, 65.163094, 65.178238, 65.193359, 65.208450, 65.223518, 65.238556, 65.253571, 65.268562, 65.283524, 65.298462, 65.313370, 65.328255, 65.343117, 65.357956, 65.372765, 65.387543, 65.402306, 65.417038, 65.431747, 65.446434, 65.461090, 65.475731, 65.490341, 65.504929, 65.519485, 65.534027, 65.548538, 65.563026, 65.577492, 65.591927, 65.606346, 65.620735, 65.635109, 65.649452, 65.663773, 65.678070, 65.692345, 65.706596, 65.720825, 65.735031, 65.749207, 65.763367, 65.777504, 65.791611, 65.805702, 65.819771, 65.833817, 65.847832, 65.861832, 65.875809, 65.889763, 65.903694, 65.917603, 65.931488, 65.945351, 65.959190, 65.973015, 65.986809, 66.000587, 66.014343, 66.028076, 66.041786, 66.055473, 66.069145, 66.082787, 66.096413, 66.110016, 66.123596, 66.137161, 66.150703, 66.164223, 66.177719, 66.191193, 66.204651, 66.218086, 66.231499, 66.244896, 66.258270, 66.271622, 66.284950, 66.298264, 66.311554, 66.324829, 66.338074, 66.351311, 66.364517, 66.377708, 66.390877, 66.404030, 66.417160, 66.430267, 66.443359, 66.456436, 66.469482, 66.482513, 66.495529, 66.508522, 66.521500, 66.534447, 66.547386, 66.560303, 66.573196, 66.586075, 66.598930, 66.611771, 66.624596, 66.637398, 66.650177, 66.662941, 66.675690, 66.688416, 66.701118, 66.713814, 66.726479, 66.739136, 66.751770, 66.764381, 66.776985, 66.789558, 66.802124, 66.814667, 66.827187, 66.839699, 66.852188, 66.864655, 66.877106, 66.889542, 66.901962, 66.914360, 66.926743, 66.939110, 66.951454, 66.963783, 66.976097, 66.988388, 67.000664, 67.012924, 67.025169, 67.037392, 67.049599, 67.061790, 67.073967, 67.086121, 67.098259, 67.110382, 67.122490, 67.134575, 67.146652, 67.158707, 67.170746, 67.182762, 67.194771, 67.206757, 67.218735, 67.230690, 67.242630, 67.254547, 67.266457, 67.278351, 67.290222, 67.302078, 67.313919, 67.325745, 67.337555, 67.349350, 67.361130, 67.372887, 67.384636, 67.396362, 67.408081, 67.419777, 67.431458, 67.443123, 67.454773, 67.466415, 67.478035, 67.489639, 67.501228, 67.512802, 67.524353, 67.535896, 67.547424, 67.558937, 67.570435, 67.581917, 67.593384, 67.604836, 67.616272, 67.627693, 67.639099, 67.650490, 67.661865, 67.673225, 67.684578, 67.695908, 67.707222, 67.718529, 67.729813, 67.741089, 67.752342, 67.763588, 67.774818, 67.786034, 67.797234, 67.808418, 67.819595, 67.830750, 67.841888, 67.853020, 67.864136, 67.875237, 67.886322, 67.897392, 67.908447, 67.919495, 67.930527, 67.941544, 67.952545, 67.963531, 67.974503, 67.985466, 67.996407, 68.007339, 68.018265, 68.029167, 68.040054, 68.050934, 68.061798, 68.072647, 68.083488, 68.094315, 68.105118, 68.115921, 68.126701, 68.137474, 68.148224, 68.158974, 68.169701, 68.180420, 68.191124, 68.201813, 68.212486, 68.223152, 68.233803, 68.244438, 68.255066, 68.265678, 68.276276, 68.286865, 68.297440, 68.307999, 68.318542, 68.329079, 68.339600, 68.350113, 68.360603, 68.371094, 68.381561, 68.392021, 68.402466, 68.412903, 68.423325, 68.433731, 68.444122, 68.454506, 68.464882, 68.475243, 68.485588, 68.495918, 68.506241, 68.516548, 68.526848, 68.537132, 68.547409, 68.557671, 68.567917, 68.578156, 68.588379, 68.598595, 68.608795, 68.618980, 68.629158, 68.639320, 68.649475, 68.659615, 68.669746, 68.679863, 68.689972, 68.700066, 68.710144, 68.720215, 68.730278, 68.740326, 68.750359, 68.760384, 68.770393, 68.780396, 68.790382, 68.800362, 68.810333, 68.820282, 68.830231, 68.840164, 68.850082, 68.859993, 68.869888, 68.879776, 68.889656, 68.899521, 68.909370, 68.919212, 68.929047, 68.938866, 68.948677, 68.958473, 68.968262, 68.978035, 68.987801, 68.997551, 69.007294, 69.017029, 69.026749, 69.036461, 69.046158, 69.055847, 69.065529, 69.075195, 69.084846, 69.094498, 69.104134, 69.113754, 69.123367, 69.132973, 69.142563, 69.152145, 69.161720, 69.171280, 69.180824, 69.190369, 69.199898, 69.209419, 69.218925, 69.228424, 69.237907, 69.247383, 69.256851, 69.266312, 69.275757, 69.285194, 69.294617, 69.304031, 69.313438, 69.322838, 69.332222, 69.341591, 69.350960, 69.360313, 69.369659, 69.378990, 69.388321, 69.397636, 69.406937, 69.416229, 69.425514, 69.434792, 69.444054, 69.453308, 69.462555, 69.471794, 69.481018, 69.490234, 69.499443, 69.508636, 69.517822, 69.527000, 69.536163, 69.545326, 69.554474, 69.563614, 69.572739, 69.581856, 69.590965, 69.600067, 69.609161, 69.618240, 69.627312, 69.636375, 69.645424, 69.654465, 69.663498, 69.672523, 69.681541, 69.690544, 69.699539, 69.708527, 69.717506, 69.726479, 69.735435, 69.744385, 69.753326, 69.762260, 69.771179, 69.780090, 69.788994, 69.797890, 69.806778, 69.815651, 69.824524, 69.833382, 69.842232, 69.851067, 69.859901, 69.868721, 69.877541, 69.886345, 69.895142, 69.903923, 69.912704, 69.921471, 69.930237, 69.938988, 69.947731, 69.956459, 69.965187, 69.973900, 69.982613, 69.991310, 70.000000, 70.008682, 70.017357, 70.026016, 70.034676, 70.043320, 70.051956, 70.060593, 70.069214, 70.077820, 70.086426, 70.095024, 70.103607, 70.112190, 70.120758, 70.129318, 70.137871, 70.146416, 70.154953, 70.163483, 70.172005, 70.180511, 70.189018, 70.197510, 70.206001, 70.214478, 70.222946, 70.231407, 70.239861, 70.248306, 70.256744, 70.265175, 70.273598, 70.282005, 70.290413, 70.298805, 70.307198, 70.315575, 70.323944, 70.332314, 70.340668, 70.349014, 70.357353, 70.365685, 70.374008, 70.382324, 70.390633, 70.398933, 70.407227, 70.415512, 70.423782, 70.432053, 70.440315, 70.448570, 70.456810, 70.465050, 70.473282, 70.481499, 70.489716, 70.497917, 70.506119, 70.514305, 70.522491, 70.530663, 70.538834, 70.546989, 70.555145, 70.563286, 70.571426, 70.579552, 70.587677, 70.595787, 70.603897, 70.611992, 70.620087, 70.628166, 70.636246, 70.644318, 70.652374, 70.660431, 70.668472, 70.676514, 70.684547, 70.692566, 70.700584, 70.708595, 70.716599, 70.724594, 70.732574, 70.740555, 70.748528, 70.756493, 70.764450, 70.772400, 70.780350, 70.788284, 70.796211, 70.804131, 70.812050, 70.819954, 70.827850, 70.835747, 70.843636, 70.851509, 70.859383, 70.867249, 70.875099, 70.882950, 70.890793, 70.898628, 70.906456, 70.914284, 70.922096, 70.929901, 70.937706, 70.945496, 70.953285, 70.961067, 70.968834, 70.976601, 70.984360, 70.992111, 70.999855, 71.007599, 71.015327, 71.023048, 71.030769, 71.038475, 71.046181, 71.053879, 71.061569, 71.069252, 71.076927, 71.084595, 71.092262, 71.099915, 71.107567, 71.115211, 71.122849, 71.130478, 71.138100, 71.145714, 71.153320, 71.160927, 71.168518, 71.176109, 71.183693, 71.191269, 71.198837, 71.206398, 71.213959, 71.221504, 71.229050, 71.236588, 71.244118, 71.251640, 71.259155, 71.266670, 71.274170, 71.281670, 71.289162, 71.296646, 71.304123, 71.311592, 71.319061, 71.326515, 71.333969, 71.341415, 71.348854, 71.356293, 71.363716, 71.371140, 71.378555, 71.385963, 71.393364, 71.400757, 71.408150, 71.415527, 71.422905, 71.430275, 71.437637, 71.445000, 71.452347, 71.459694, 71.467033, 71.474365, 71.481697, 71.489014, 71.496330, 71.503639, 71.510941, 71.518234, 71.525528, 71.532806, 71.540085, 71.547356, 71.554626, 71.561882, 71.569138, 71.576385, 71.583626, 71.590858, 71.598091, 71.605316, 71.612526, 71.619743, 71.626945, 71.634148, 71.641342, 71.648529, 71.655708, 71.662880, 71.670052, 71.677216, 71.684372, 71.691528, 71.698669, 71.705811, 71.712944, 71.720078, 71.727196, 71.734314, 71.741425, 71.748528, 71.755630, 71.762718, 71.769806, 71.776894, 71.783966, 71.791039, 71.798103, 71.805161, 71.812218, 71.819260, 71.826302, 71.833336, 71.840370, 71.847397, 71.854416, 71.861427, 71.868431, 71.875435, 71.882431, 71.889420, 71.896408, 71.903389, 71.910362, 71.917328, 71.924294, 71.931252, 71.938202, 71.945145, 71.952087, 71.959023, 71.965950, 71.972878, 71.979790, 71.986702, 71.993614, 72.000511, 72.007408, 72.014305, 72.021187, 72.028069, 72.034943, 72.041809, 72.048676, 72.055534, 72.062386, 72.069229, 72.076073, 72.082909, 72.089745, 72.096565, 72.103386, 72.110207, 72.117012, 72.123817, 72.130615, 72.137413, 72.144203, 72.150986, 72.157761, 72.164536, 72.171303, 72.178062, 72.184822, 72.191574, 72.198318, 72.205055, 72.211792, 72.218521, 72.225250, 72.231972, 72.238686, 72.245392, 72.252098, 72.258797, 72.265495, 72.272186, 72.278870, 72.285545, 72.292221, 72.298889, 72.305550, 72.312210, 72.318863, 72.325508, 72.332153, 72.338791, 72.345428, 72.352051, 72.358673, 72.365295, 72.371910, 72.378517, 72.385117, 72.391716, 72.398308, 72.404900, 72.411476, 72.418053, 72.424629, 72.431198, 72.437759, 72.444321, 72.450867, 72.457420, 72.463959, 72.470497, 72.477036, 72.483559, 72.490082, 72.496605, 72.503113, 72.509628, 72.516129, 72.522629, 72.529121, 72.535614, 72.542099, 72.548576, 72.555054, 72.561523, 72.567986, 72.574448, 72.580902, 72.587349, 72.593796, 72.600243, 72.606674, 72.613106, 72.619537, 72.625954, 72.632370, 72.638786, 72.645195, 72.651596, 72.657997, 72.664391, 72.670776, 72.677162, 72.683540, 72.689919, 72.696289, 72.702652, 72.709015, 72.715370, 72.721725, 72.728065, 72.734413, 72.740746, 72.747086, 72.753410, 72.759735, 72.766052, 72.772369, 72.778679, 72.784981, 72.791283, 72.797585, 72.803871, 72.810158, 72.816444, 72.822723, 72.828995, 72.835266, 72.841530, 72.847786, 72.854042, 72.860298, 72.866539, 72.872787, 72.879021, 72.885254, 72.891487, 72.897705, 72.903931, 72.910141, 72.916351, 72.922562, 72.928764, 72.934959, 72.941154, 72.947342, 72.953529, 72.959709, 72.965881, 72.972054, 72.978218, 72.984383, 72.990540, 72.996696, 73.002846, 73.008987, 73.015129, 73.021263, 73.027397, 73.033524, 73.039650, 73.045769, 73.051880, 73.057991, 73.064095, 73.070198, 73.076294, 73.082390, 73.088478, 73.094566, 73.100647, 73.106720, 73.112793, 73.118858, 73.124924, 73.130981, 73.137039, 73.143089, 73.149132, 73.155174, 73.161217, 73.167252, 73.173279, 73.179306, 73.185326, 73.191345, 73.197357, 73.203369, 73.209373, 73.215370, 73.221367, 73.227364, 73.233345, 73.239334, 73.245316, 73.251289, 73.257263, 73.263229, 73.269188, 73.275154, 73.281105, 73.287056, 73.293007, 73.298950, 73.304886, 73.310822, 73.316750, 73.322678, 73.328606, 73.334518, 73.340439, 73.346344, 73.352257, 73.358154, 73.364052, 73.369949, 73.375839, 73.381729, 73.387611, 73.393486, 73.399361, 73.405235, 73.411102, 73.416962, 73.422821, 73.428680, 73.434532, 73.440376, 73.446220, 73.452057, 73.457893, 73.463722, 73.469551, 73.475380, 73.481194, 73.487015, 73.492821, 73.498634, 73.504433, 73.510239, 73.516029, 73.521828, 73.527611, 73.533401, 73.539177, 73.544960, 73.550728, 73.556496, 73.562263, 73.568024, 73.573784, 73.579536, 73.585289, 73.591034, 73.596779, 73.602516, 73.608253, 73.613983, 73.619713, 73.625435, 73.631157, 73.636871, 73.642586, 73.648293, 73.653999, 73.659698, 73.665398, 73.671089, 73.676781, 73.682465, 73.688148, 73.693832, 73.699501, 73.705177, 73.710846, 73.716507, 73.722168, 73.727821, 73.733475, 73.739128, 73.744774, 73.750412, 73.756050, 73.761688, 73.767319, 73.772949, 73.778572, 73.784187, 73.789803, 73.795418, 73.801025, 73.806633, 73.812233, 73.817833, 73.823433, 73.829018, 73.834610, 73.840195, 73.845772, 73.851349, 73.856926, 73.862495, 73.868057, 73.873619, 73.879181, 73.884735, 73.890289, 73.895836, 73.901382, 73.906921, 73.912460, 73.917992, 73.923523, 73.929054, 73.934578, 73.940094, 73.945610, 73.951126, 73.956635, 73.962143, 73.967644, 73.973145, 73.978638, 73.984131, 73.989616, 73.995102, 74.000587, 74.006065, 74.011536, 74.017014, 74.022476, 74.027939, 74.033401, 74.038864, 74.044319, 74.049767, 74.055214, 74.060661, 74.066101, 74.071533, 74.076973, 74.082397, 74.087830, 74.093246, 74.098671, 74.104088, 74.109497, 74.114914, 74.120316, 74.125717, 74.131119, 74.136520, 74.141914, 74.147301, 74.152687, 74.158073, 74.163452, 74.168831, 74.174202, 74.179573, 74.184937, 74.190300, 74.195663, 74.201019, 74.206367, 74.211723, 74.217064, 74.222412, 74.227753, 74.233086, 74.238419, 74.243752, 74.249077, 74.254402, 74.259727, 74.265038, 74.270355, 74.275665, 74.280975, 74.286278, 74.291580, 74.296875, 74.302170, 74.307465, 74.312752, 74.318039, 74.323318, 74.328598, 74.333870, 74.339142, 74.344414, 74.349678, 74.354942, 74.360199, 74.365456, 74.370712, 74.375961, 74.381210, 74.386452, 74.391693, 74.396927, 74.402161, 74.407394, 74.412621, 74.417847, 74.423065, 74.428284, 74.433502, 74.438713, 74.443924, 74.449127, 74.454330, 74.459526, 74.464722, 74.469917, 74.475105, 74.480293, 74.485481, 74.490662, 74.495842, 74.501015, 74.506187, 74.511353, 74.516518, 74.521683, 74.526840, 74.531998, 74.537155, 74.542305, 74.547447, 74.552589, 74.557732, 74.562874, 74.568008, 74.573135, 74.578270, 74.583397, 74.588516, 74.593636, 74.598755, 74.603867, 74.608978, 74.614090, 74.619194, 74.624290, 74.629395, 74.634491, 74.639580, 74.644669, 74.649757, 74.654839, 74.659920, 74.665001, 74.670074, 74.675148, 74.680214, 74.685280, 74.690346, 74.695404, 74.700462, 74.705521, 74.710571, 74.715614, 74.720665, 74.725708, 74.730743, 74.735779, 74.740814, 74.745850, 74.750877, 74.755898, 74.760925, 74.765938, 74.770958, 74.775970, 74.780983, 74.785988, 74.790993, 74.795998, 74.800995, 74.805992, 74.810982, 74.815979, 74.820961, 74.825951, 74.830933, 74.835907, 74.840881, 74.845856, 74.850830, 74.855797, 74.860764, 74.865723, 74.870682, 74.875641, 74.880592, 74.885544, 74.890488, 74.895432, 74.900375, 74.905319, 74.910255, 74.915184, 74.920120, 74.925049, 74.929970, 74.934891, 74.939812, 74.944733, 74.949646, 74.954559, 74.959465, 74.964371, 74.969276, 74.974174, 74.979073, 74.983971, 74.988861, 74.993752, 74.998634, 75.003517, 75.008400, 75.013275, 75.018150, 75.023026, 75.027901, 75.032761, 75.037628, 75.042488, 75.047348, 75.052208, 75.057060, 75.061913, 75.066757, 75.071609, 75.076447, 75.081291, 75.086128, 75.090965, 75.095795, 75.100624, 75.105453, 75.110275, 75.115097, 75.119911, 75.124733, 75.129547, 75.134354, 75.139160, 75.143967, 75.148773, 75.153572, 75.158371, 75.163162, 75.167953, 75.172745, 75.177536, 75.182320, 75.187096, 75.191879, 75.196655, 75.201431, 75.206200, 75.210968, 75.215736, 75.220497, 75.225258, 75.230019, 75.234772, 75.239525, 75.244270, 75.249023, 75.253769, 75.258507, 75.263252, 75.267990, 75.272720, 75.277451, 75.282181, 75.286911, 75.291634, 75.296356, 75.301079, 75.305794, 75.310509, 75.315216, 75.319931, 75.324631, 75.329338, 75.334038, 75.338737, 75.343437, 75.348129, 75.352821, 75.357506, 75.362198, 75.366875, 75.371559, 75.376236, 75.380913, 75.385590, 75.390259, 75.394928, 75.399597, 75.404259, 75.408920, 75.413574, 75.418236, 75.422890, 75.427536, 75.432182, 75.436829, 75.441475, 75.446114, 75.450752, 75.455391, 75.460022, 75.464653, 75.469284, 75.473915, 75.478539, 75.483154, 75.487778, 75.492393, 75.497009, 75.501617, 75.506226, 75.510834, 75.515434, 75.520042, 75.524643, 75.529236, 75.533829, 75.538422, 75.543015, 75.547600, 75.552185, 75.556770, 75.561348, 75.565926, 75.570496, 75.575073, 75.579643, 75.584213, 75.588776, 75.593338, 75.597900, 75.602455, 75.607018, 75.611565, 75.616119, 75.620667, 75.625214, 75.629761, 75.634300, 75.638840, 75.643379, 75.647911, 75.652443, 75.656975, 75.661499, 75.666023, 75.670547, 75.675064, 75.679588, 75.684105, 75.688614, 75.693123, 75.697632, 75.702141, 75.706642, 75.711143, 75.715645, 75.720146, 75.724640, 75.729126, 75.733620, 75.738106, 75.742592, 75.747078, 75.751556, 75.756035, 75.760513, 75.764984, 75.769455, 75.773926, 75.778389, 75.782860, 75.787315, 75.791779, 75.796234, 75.800690, 75.805145, 75.809593, 75.814041, 75.818489, 75.822937, 75.827377, 75.831818, 75.836250, 75.840691, 75.845123, 75.849548, 75.853981, 75.858406, 75.862831, 75.867249, 75.871674, 75.876091, 75.880501, 75.884911, 75.889328, 75.893730, 75.898140, 75.902542, 75.906944, 75.911339, 75.915741, 75.920135, 75.924522, 75.928917, 75.933304, 75.937691, 75.942070, 75.946457, 75.950836, 75.955208, 75.959587, 75.963959, 75.968330, 75.972694, 75.977058, 75.981422, 75.985786, 75.990143, 75.994507, 75.998856, 76.003212, 76.007561, 76.011909, 76.016258
};

static double tabcos_psycho_3_fft[] = {0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000001, 0.000001, 0.000001, 0.000001, 0.000002, 0.000002, 0.000002, 0.000003, 0.000003, 0.000003, 0.000004, 0.000004, 0.000005, 0.000005, 0.000006, 0.000007, 0.000007, 0.000008, 0.000009, 0.000009, 0.000010, 0.000011, 0.000012, 0.000013, 0.000013, 0.000014, 0.000015, 0.000016, 0.000017, 0.000018, 0.000019, 0.000020, 0.000022, 0.000023, 0.000024, 0.000025, 0.000026, 0.000028, 0.000029, 0.000030, 0.000032, 0.000033, 0.000034, 0.000036, 0.000037, 0.000039, 0.000040, 0.000042, 0.000043, 0.000045, 0.000047, 0.000048, 0.000050, 0.000052, 0.000053, 0.000055, 0.000057, 0.000059, 0.000061, 0.000063, 0.000064, 0.000066, 0.000068, 0.000070, 0.000072, 0.000074, 0.000077, 0.000079, 0.000081, 0.000083, 0.000085, 0.000087, 0.000090, 0.000092, 0.000094, 0.000096, 0.000099, 0.000101, 0.000104, 0.000106, 0.000108, 0.000111, 0.000113, 0.000116, 0.000119, 0.000121, 0.000124, 0.000126, 0.000129, 0.000132, 0.000134, 0.000137, 0.000140, 0.000143, 0.000145, 0.000148, 0.000151, 0.000154, 0.000157, 0.000160, 0.000163, 0.000166, 0.000169, 0.000172, 0.000175, 0.000178, 0.000181, 0.000184, 0.000187, 0.000190, 0.000194, 0.000197, 0.000200, 0.000203, 0.000207, 0.000210, 0.000213, 0.000217, 0.000220, 0.000223, 0.000227, 0.000230, 0.000234, 0.000237, 0.000241, 0.000244, 0.000248, 0.000251, 0.000255, 0.000258, 0.000262, 0.000266, 0.000269, 0.000273, 0.000277, 0.000280, 0.000284, 0.000288, 0.000292, 0.000295, 0.000299, 0.000303, 0.000307, 0.000311, 0.000315, 0.000318, 0.000322, 0.000326, 0.000330, 0.000334, 0.000338, 0.000342, 0.000346, 0.000350, 0.000354, 0.000358, 0.000363, 0.000367, 0.000371, 0.000375, 0.000379, 0.000383, 0.000387, 0.000392, 0.000396, 0.000400, 0.000404, 0.000409, 0.000413, 0.000417, 0.000421, 0.000426, 0.000430, 0.000434, 0.000439, 0.000443, 0.000448, 0.000452, 0.000456, 0.000461, 0.000465, 0.000470, 0.000474, 0.000479, 0.000483, 0.000488, 0.000492, 0.000497, 0.000501, 0.000506, 0.000510, 0.000515, 0.000520, 0.000524, 0.000529, 0.000533, 0.000538, 0.000543, 0.000547, 0.000552, 0.000557, 0.000561, 0.000566, 0.000571, 0.000575, 0.000580, 0.000585, 0.000589, 0.000594, 0.000599, 0.000604, 0.000608, 0.000613, 0.000618, 0.000623, 0.000627, 0.000632, 0.000637, 0.000642, 0.000647, 0.000651, 0.000656, 0.000661, 0.000666, 0.000671, 0.000676, 0.000680, 0.000685, 0.000690, 0.000695, 0.000700, 0.000705, 0.000709, 0.000714, 0.000719, 0.000724, 0.000729, 0.000734, 0.000739, 0.000744, 0.000748, 0.000753, 0.000758, 0.000763, 0.000768, 0.000773, 0.000778, 0.000783, 0.000788, 0.000792, 0.000797, 0.000802, 0.000807, 0.000812, 0.000817, 0.000822, 0.000827, 0.000832, 0.000836, 0.000841, 0.000846, 0.000851, 0.000856, 0.000861, 0.000866, 0.000871, 0.000876, 0.000880, 0.000885, 0.000890, 0.000895, 0.000900, 0.000905, 0.000910, 0.000914, 0.000919, 0.000924, 0.000929, 0.000934, 0.000938, 0.000943, 0.000948, 0.000953, 0.000958, 0.000963, 0.000967, 0.000972, 0.000977, 0.000982, 0.000986, 0.000991, 0.000996, 0.001001, 0.001005, 0.001010, 0.001015, 0.001019, 0.001024, 0.001029, 0.001033, 0.001038, 0.001043, 0.001047, 0.001052, 0.001057, 0.001061, 0.001066, 0.001071, 0.001075, 0.001080, 0.001084, 0.001089, 0.001093, 0.001098, 0.001102, 0.001107, 0.001112, 0.001116, 0.001120, 0.001125, 0.001129, 0.001134, 0.001138, 0.001143, 0.001147, 0.001151, 0.001156, 0.001160, 0.001165, 0.001169, 0.001173, 0.001178, 0.001182, 0.001186, 0.001190, 0.001195, 0.001199, 0.001203, 0.001207, 0.001211, 0.001216, 0.001220, 0.001224, 0.001228, 0.001232, 0.001236, 0.001240, 0.001244, 0.001248, 0.001252, 0.001256, 0.001260, 0.001264, 0.001268, 0.001272, 0.001276, 0.001280, 0.001284, 0.001288, 0.001292, 0.001296, 0.001299, 0.001303, 0.001307, 0.001311, 0.001314, 0.001318, 0.001322, 0.001326, 0.001329, 0.001333, 0.001336, 0.001340, 0.001344, 0.001347, 0.001351, 0.001354, 0.001358, 0.001361, 0.001365, 0.001368, 0.001371, 0.001375, 0.001378, 0.001382, 0.001385, 0.001388, 0.001391, 0.001395, 0.001398, 0.001401, 0.001404, 0.001407, 0.001411, 0.001414, 0.001417, 0.001420, 0.001423, 0.001426, 0.001429, 0.001432, 0.001435, 0.001438, 0.001441, 0.001444, 0.001446, 0.001449, 0.001452, 0.001455, 0.001458, 0.001460, 0.001463, 0.001466, 0.001468, 0.001471, 0.001474, 0.001476, 0.001479, 0.001481, 0.001484, 0.001486, 0.001489, 0.001491, 0.001494, 0.001496, 0.001498, 0.001501, 0.001503, 0.001505, 0.001507, 0.001510, 0.001512, 0.001514, 0.001516, 0.001518, 0.001520, 0.001522, 0.001524, 0.001526, 0.001528, 0.001530, 0.001532, 0.001534, 0.001536, 0.001538, 0.001540, 0.001541, 0.001543, 0.001545, 0.001546, 0.001548, 0.001550, 0.001551, 0.001553, 0.001554, 0.001556, 0.001557, 0.001559, 0.001560, 0.001562, 0.001563, 0.001565, 0.001566, 0.001567, 0.001568, 0.001570, 0.001571, 0.001572, 0.001573, 0.001574, 0.001575, 0.001576, 0.001577, 0.001578, 0.001579, 0.001580, 0.001581, 0.001582, 0.001583, 0.001584, 0.001585, 0.001585, 0.001586, 0.001587, 0.001587, 0.001588, 0.001589, 0.001589, 0.001590, 0.001590, 0.001591, 0.001591, 0.001592, 0.001592, 0.001593, 0.001593, 0.001593, 0.001594, 0.001594, 0.001594, 0.001594, 0.001594, 0.001594, 0.001595, 0.001595, 0.001595, 0.001595, 0.001595, 0.001595, 0.001595, 0.001594, 0.001594, 0.001594, 0.001594, 0.001594, 0.001594, 0.001593, 0.001593, 0.001593, 0.001592, 0.001592, 0.001591, 0.001591, 0.001590, 0.001590, 0.001589, 0.001589, 0.001588, 0.001587, 0.001587, 0.001586, 0.001585, 0.001585, 0.001584, 0.001583, 0.001582, 0.001581, 0.001580, 0.001579, 0.001578, 0.001577, 0.001576, 0.001575, 0.001574, 0.001573, 0.001572, 0.001571, 0.001570, 0.001568, 0.001567, 0.001566, 0.001565, 0.001563, 0.001562, 0.001560, 0.001559, 0.001557, 0.001556, 0.001554, 0.001553, 0.001551, 0.001550, 0.001548, 0.001546, 0.001545, 0.001543, 0.001541, 0.001540, 0.001538, 0.001536, 0.001534, 0.001532, 0.001530, 0.001528, 0.001526, 0.001524, 0.001522, 0.001520, 0.001518, 0.001516, 0.001514, 0.001512, 0.001510, 0.001507, 0.001505, 0.001503, 0.001501, 0.001498, 0.001496, 0.001494, 0.001491, 0.001489, 0.001486, 0.001484, 0.001481, 0.001479, 0.001476, 0.001474, 0.001471, 0.001468, 0.001466, 0.001463, 0.001460, 0.001458, 0.001455, 0.001452, 0.001449, 0.001446, 0.001444, 0.001441, 0.001438, 0.001435, 0.001432, 0.001429, 0.001426, 0.001423, 0.001420, 0.001417, 0.001414, 0.001411, 0.001407, 0.001404, 0.001401, 0.001398, 0.001395, 0.001391, 0.001388, 0.001385, 0.001382, 0.001378, 0.001375, 0.001371, 0.001368, 0.001365, 0.001361, 0.001358, 0.001354, 0.001351, 0.001347, 0.001344, 0.001340, 0.001336, 0.001333, 0.001329, 0.001326, 0.001322, 0.001318, 0.001314, 0.001311, 0.001307, 0.001303, 0.001299, 0.001296, 0.001292, 0.001288, 0.001284, 0.001280, 0.001276, 0.001272, 0.001268, 0.001264, 0.001260, 0.001256, 0.001252, 0.001248, 0.001244, 0.001240, 0.001236, 0.001232, 0.001228, 0.001224, 0.001220, 0.001216, 0.001211, 0.001207, 0.001203, 0.001199, 0.001195, 0.001190, 0.001186, 0.001182, 0.001178, 0.001173, 0.001169, 0.001165, 0.001160, 0.001156, 0.001151, 0.001147, 0.001143, 0.001138, 0.001134, 0.001129, 0.001125, 0.001120, 0.001116, 0.001112, 0.001107, 0.001102, 0.001098, 0.001093, 0.001089, 0.001084, 0.001080, 0.001075, 0.001071, 0.001066, 0.001061, 0.001057, 0.001052, 0.001047, 0.001043, 0.001038, 0.001033, 0.001029, 0.001024, 0.001019, 0.001015, 0.001010, 0.001005, 0.001001, 0.000996, 0.000991, 0.000986, 0.000982, 0.000977, 0.000972, 0.000967, 0.000963, 0.000958, 0.000953, 0.000948, 0.000943, 0.000938, 0.000934, 0.000929, 0.000924, 0.000919, 0.000914, 0.000910, 0.000905, 0.000900, 0.000895, 0.000890, 0.000885, 0.000880, 0.000876, 0.000871, 0.000866, 0.000861, 0.000856, 0.000851, 0.000846, 0.000841, 0.000836, 0.000832, 0.000827, 0.000822, 0.000817, 0.000812, 0.000807, 0.000802, 0.000797, 0.000792, 0.000788, 0.000783, 0.000778, 0.000773, 0.000768, 0.000763, 0.000758, 0.000753, 0.000748, 0.000744, 0.000739, 0.000734, 0.000729, 0.000724, 0.000719, 0.000714, 0.000709, 0.000705, 0.000700, 0.000695, 0.000690, 0.000685, 0.000680, 0.000676, 0.000671, 0.000666, 0.000661, 0.000656, 0.000651, 0.000647, 0.000642, 0.000637, 0.000632, 0.000627, 0.000623, 0.000618, 0.000613, 0.000608, 0.000604, 0.000599, 0.000594, 0.000589, 0.000585, 0.000580, 0.000575, 0.000571, 0.000566, 0.000561, 0.000557, 0.000552, 0.000547, 0.000543, 0.000538, 0.000533, 0.000529, 0.000524, 0.000520, 0.000515, 0.000510, 0.000506, 0.000501, 0.000497, 0.000492, 0.000488, 0.000483, 0.000479, 0.000474, 0.000470, 0.000465, 0.000461, 0.000456, 0.000452, 0.000448, 0.000443, 0.000439, 0.000434, 0.000430, 0.000426, 0.000421, 0.000417, 0.000413, 0.000409, 0.000404, 0.000400, 0.000396, 0.000392, 0.000387, 0.000383, 0.000379, 0.000375, 0.000371, 0.000367, 0.000363, 0.000358, 0.000354, 0.000350, 0.000346, 0.000342, 0.000338, 0.000334, 0.000330, 0.000326, 0.000322, 0.000318, 0.000315, 0.000311, 0.000307, 0.000303, 0.000299, 0.000295, 0.000292, 0.000288, 0.000284, 0.000280, 0.000277, 0.000273, 0.000269, 0.000266, 0.000262, 0.000258, 0.000255, 0.000251, 0.000248, 0.000244, 0.000241, 0.000237, 0.000234, 0.000230, 0.000227, 0.000223, 0.000220, 0.000217, 0.000213, 0.000210, 0.000207, 0.000203, 0.000200, 0.000197, 0.000194, 0.000190, 0.000187, 0.000184, 0.000181, 0.000178, 0.000175, 0.000172, 0.000169, 0.000166, 0.000163, 0.000160, 0.000157, 0.000154, 0.000151, 0.000148, 0.000145, 0.000143, 0.000140, 0.000137, 0.000134, 0.000132, 0.000129, 0.000126, 0.000124, 0.000121, 0.000119, 0.000116, 0.000113, 0.000111, 0.000108, 0.000106, 0.000104, 0.000101, 0.000099, 0.000096, 0.000094, 0.000092, 0.000090, 0.000087, 0.000085, 0.000083, 0.000081, 0.000079, 0.000077, 0.000074, 0.000072, 0.000070, 0.000068, 0.000066, 0.000064, 0.000063, 0.000061, 0.000059, 0.000057, 0.000055, 0.000053, 0.000052, 0.000050, 0.000048, 0.000047, 0.000045, 0.000043, 0.000042, 0.000040, 0.000039, 0.000037, 0.000036, 0.000034, 0.000033, 0.000032, 0.000030, 0.000029, 0.000028, 0.000026, 0.000025, 0.000024, 0.000023, 0.000022, 0.000020, 0.000019, 0.000018, 0.000017, 0.000016, 0.000015, 0.000014, 0.000013, 0.000013, 0.000012, 0.000011, 0.000010, 0.000009, 0.000009, 0.000008, 0.000007, 0.000007, 0.000006, 0.000005, 0.000005, 0.000004, 0.000004, 0.000003, 0.000003, 0.000003, 0.000002, 0.000002, 0.000002, 0.000001, 0.000001, 0.000001, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000
};


/* This is a reimplementation of psy model 1 using the ISO11172 standard.
   I found the original dist10 code (which is full of pointers) to be
   a horrible thing to try and understand and debug.
   This implementation is not built for speed, but is rather meant to
   clearly outline the steps specified by the standard (still, it's only
   a tiny fraction slower than the dist10 code, and nothing has been optimized)
   MFC Feb 2003 */

static inline FLOAT psycho_3_add_db(psycho_3_mem * mem, FLOAT a, FLOAT b)
{
    /* MFC - if the difference between a and b is large (>99), then just return the largest one.
       (about 10% of the time) - For differences between 0 and 99, return the largest value, but
       add in a pre-calculated difference value. - the value 99 was chosen arbitarily. - maximum
       (a-b) i've seen is 572 */
    FLOAT fdiff;
    int idiff;
    fdiff = (10.0 * (a - b));

    if (fdiff > 990.0) {
        return a;
    }
    if (fdiff < -990.0) {
        return (b);
    }

    idiff = (int) fdiff;
    if (idiff >= 0) {
        return (a + mem->dbtable[idiff]);
    }

    return (b + mem->dbtable[-idiff]);
}



/* ISO11172 Sec D.1 Step 1 - Window with HANN and then perform the FFT */
static void psycho_3_fft(FLOAT sample[BLKSIZE], FLOAT energy[BLKSIZE])
{
    FLOAT x_real[BLKSIZE];
    int i;
    static int init = 0;
    static FLOAT window[FFT_SIZE];

    if (!init) {                /* calculate window function for the Fourier transform */
        //FLOAT sqrt_8_over_3 = pow(8.0 / 3.0, 0.5);
        for (i = 0; i < BLKSIZE; i++) {
            //window[i] = sqrt_8_over_3 * 0.5 * (1 - cos(2.0 * PI * i / (BLKSIZE))) / BLKSIZE;
            window[i] = tabcos_psycho_3_fft[i];
        }
        init=1;
    }

    /* convolve the samples with the hann window */
    for (i = 0; i < BLKSIZE; i++)
        x_real[i] = (FLOAT) (sample[i] * window[i]);
    /* do the FFT */
    twolame_psycho_1_fft(x_real, energy, BLKSIZE);
}


/* Sect D.1 Step 1 - convert the energies into dB */
static void psycho_3_powerdensityspectrum(FLOAT energy[BLKSIZE], FLOAT power[HBLKSIZE])
{
    int i;
    for (i = 1; i < HBLKSIZE; i++) {
        if (energy[i] < 1E-20){
            power[i] = -200.0 + POWERNORM;
        }else{
            //power[i] = 10 * log10(energy[i]) + POWERNORM;
            int aux = (int)(energy[i]*10000);
            if (aux > 511) aux=511;
            power[i] = tablog10_psycho_3_powerdensityspectrum[aux] + POWERNORM;
        }
    }
}


/* Sect D.1 Step 2 - Determine the sound pressure level in each subband */
static void psycho_3_spl(FLOAT * Lsb, FLOAT * power, FLOAT * scale)
{
    int i;
    FLOAT Xmax[SBLIMIT];

    for (i = 0; i < SBLIMIT; i++) {
        Xmax[i] = DBMIN;
    }
    /* Find the maximum SPL in the power spectrum */
    for (i = 1; i < HBLKSIZE; i++) {
        int index = (i - 1) >> 4;
        if (Xmax[index] < power[i])
            Xmax[index] = power[i];
    }

    /* Compare it to the sound pressure based upon the scale for this subband and pick the maximum
       one */
    for (i = 0; i < SBLIMIT; i++) {
        //FLOAT val = 20 * log10(scale[i] * 32768) - 10;
        int aux = (int)(scale[i] * 3276.8);
        if (aux > 1999) aux=1999;
        FLOAT val = tablog10_psycho_3_spl[aux];
        Lsb[i] = MAX(Xmax[i], val);
    }
}


/* Sect D.1 Step4b
   A tone within the range (start -> end), must be 7.0 dB greater than
   all it's neighbours within +/- srange. Don't count its immediate neighbours. */
static void psycho_3_tonal_label_range(psycho_3_mem * mem, FLOAT * power, int *tonelabel,
                                       int *maxima, FLOAT * Xtm, int start, int end, int srange)
{
    int j, k;

    for (k = start; k < end; k++)   /* Search for all the maxima in this range */
        if (maxima[k] == 1) {
            tonelabel[k] = TONE;    /* assume it's a TONE and then prove otherwise */
            for (j = -srange; j <= +srange; j++)    /* Check the neighbours within +/- srange */
                if (abs(j) > 1) /* Don't count the immediate neighbours, or itself */
                    if ((power[k] - power[k + j]) < 7.0)
                        tonelabel[k] = 0;   /* Not greater by 7dB, therefore not a tone */
            if (tonelabel[k] == TONE) {
                /* Calculate the sound pressure level for this tone by summing the adjacent
                   spectral lines Xtm[k] = 10 * log10( pow(10.0, 0.1*power[k-1]) + pow(10.0,
                   0.1*power[k]) + pow(10.0, 0.1*power[k+1]) ); */
                FLOAT temp = psycho_3_add_db(mem, power[k - 1], power[k]);
                Xtm[k] = psycho_3_add_db(mem, temp, power[k + 1]);

                /* *ALL* spectral lines within +/- srange are set to -inf dB So that when we do the
                   noise calculate, they are not counted */
                for (j = -srange; j <= +srange; j++)
                    power[k + j] = DBMIN;
            }
        }
}


/* Sect D.1 Step 4 Label the Tonal Components */
static void psycho_3_tonal_label(psycho_3_mem * mem, FLOAT power[HBLKSIZE], int *tonelabel,
                                 FLOAT Xtm[HBLKSIZE])
{
    int i;
    int maxima[HBLKSIZE];

    /* Find the maxima as per ISO11172 D.1.4.a */
    maxima[0] = maxima[HBLKSIZE - 1] = 0;
    tonelabel[0] = tonelabel[HBLKSIZE - 1] = 0;
    Xtm[0] = Xtm[HBLKSIZE - 1] = DBMIN;
    for (i = 1; i < HBLKSIZE - 1; i++) {
        tonelabel[i] = 0;
        Xtm[i] = DBMIN;
        if (power[i] > power[i - 1] && power[i] > power[i + 1]) /* The first criteria for a maximum
                                                                 */
            maxima[i] = 1;
        else
            maxima[i] = 0;
    }

    {
        /* Now find the tones as per ISO11172 D.1 Step4.b */
        /* The standard is a bit vague (surprise surprise). So I'm going to assume that - a tone
           must be 7dB greater than *all* the relevant neighbours - once a tone is found, the
           neighbours are immediately set to -inf dB */

        psycho_3_tonal_label_range(mem, power, tonelabel, maxima, Xtm, 2, 63, 2);
        psycho_3_tonal_label_range(mem, power, tonelabel, maxima, Xtm, 63, 127, 3);
        psycho_3_tonal_label_range(mem, power, tonelabel, maxima, Xtm, 127, 255, 6);
        psycho_3_tonal_label_range(mem, power, tonelabel, maxima, Xtm, 255, 500, 12);

    }
}



static void psycho_3_init_add_db(psycho_3_mem * mem)
{
    int i;
    //FLOAT x;
    for (i = 0; i < DBTAB; i++) {
        //x = (FLOAT) i / 10.0;
        //mem->dbtable[i] = 10 * log10(1 + pow(10.0, x / 10.0)) - x;
        mem->dbtable[i] = tablog10_psycho_3_init_add_db[i];
    }
}


/* D.1 Step 4.c Labelling non-tonal (noise) components
   Sum the energies in each critical band (the tone energies have been removed
   during the tone labelling).
   Find the "geometric mean" of these energies - i.e. find the best spot to put the
   sum of energies within this critical band. */
static void psycho_3_noise_label(psycho_3_mem * mem, FLOAT power[HBLKSIZE], FLOAT energy[BLKSIZE],
                                 int *tonelabel, int *noiselabel, FLOAT Xnm[HBLKSIZE])
{
    int i, j;
    int cbands = mem->cbands;
    int *cbandindex = mem->cbandindex;

    Xnm[0] = DBMIN;
    for (i = 0; i < cbands; i++) {
        /* for each critical band */
        FLOAT sum = DBMIN;
        FLOAT esum = 0;
        FLOAT centreweight = 0;
        int centre;
        for (j = cbandindex[i]; j < cbandindex[i + 1]; j++) {
            Xnm[j] = DBMIN;
            /* go through all the spectral lines within the critical band, adding the energies. The
               tone energies have already been removed */
            if (power[j] != DBMIN) {
                /* Found a noise energy, add it to the sum */
                sum = psycho_3_add_db(mem, power[j], sum);

                /* calculations for the geometric mean FIXME MFC Feb 2003: Would it just be easier
                   to do the *whole* of psycho_1 in the energy domain rather than in the dB domain?
                   FIXME: This is just a lazy arsed arithmetic mean. Don't know if it's really going
                   to make that much difference */
                esum += energy[j];  /* Calculate the sum of energies */
                centreweight += (j - cbandindex[i]) * energy[j];    /* And the energy moment */
            }
        }

        /* MEANX, crash on AMD64 without this hack. See
           https://sourceforge.net/tracker/?func=detail&atid=735435&aid=1453400&group_id=136040
           Probably a better way to do this */
        if (sum <= DBMIN || esum < 0.00001)
            /* If the energy sum is really small, just pretend the noise occurs in the centre
               frequency line */
            centre = (cbandindex[i] + cbandindex[i + 1]) / 2;
        else {
            /* Otherwise, work out the mean position of the noise, and put it there. */
            centre = cbandindex[i] + (int) (centreweight / esum);
        }
        // /MEANX
        Xnm[centre] = sum;
        noiselabel[centre] = NOISE;
    }
}


/* ISO11172 D.1 Step 5
   Get rid of noise/tones that aren't greater than the ATH
   If two tones are within 0.5bark, then delete the tone with the lower energy */
static void psycho_3_decimation(FLOAT * ath, int *tonelabel, FLOAT * Xtm, int *noiselabel,
                                FLOAT * Xnm, FLOAT * bark)
{
    int i;

    /* Delete components which aren't above the ATH */
    for (i = 1; i < HBLKSIZE; i++) {
        if (noiselabel[i] == NOISE) {
            if (Xnm[i] < ath[i]) {
                /* this masker isn't above the ATH : delete it */
                Xnm[i] = DBMIN;
                noiselabel[i] = 0;
            }
        }
        if (tonelabel[i] == TONE) {
            if (Xtm[i] < ath[i]) {
                Xtm[i] = DBMIN;
                tonelabel[i] = 0;
            }
        }
    }
    /* Search for tones that are within 0.5 bark */
    /* MFC FIXME Feb 2003: haven't done this yet */

}


/* ISO11172 Sect D.1 Step 6
   Calculation of individual masking thresholds
   Work out how each of the tones&noises maskes other frequencies
   NOTE: Only a subset of other frequencies is checked. According to the
   standard different subbands are subsampled to different amounts.
   See psycho_3_init and freq_subset */
static void psycho_3_threshold(psycho_3_mem * mem, FLOAT * LTg, int *tonelabel, FLOAT * Xtm,
                               int *noiselabel, FLOAT * Xnm, FLOAT * bark, FLOAT * ath,
                               int bit_rate, int *freq_subset)
{
    int i, j, k;
    FLOAT LTtm[SUBSIZE];
    FLOAT LTnm[SUBSIZE];

    for (i = 0; i < SUBSIZE; i++) {
        LTtm[i] = DBMIN;
        LTnm[i] = DBMIN;
    }
    /* Loop over the entire spectrum and find every noise and tone And then with each noise/tone
       work out how it masks the spectral lines around it */
    for (k = 1; k < HBLKSIZE; k++) {
        /* Find every tone */
        if (tonelabel[k] == TONE) {
            for (j = 0; j < SUBSIZE; j++) {
                /* figure out how it masks the levels around it */
                FLOAT dz = bark[freq_subset[j]] - bark[k];
                if (dz >= -3.0 && dz < 8.0) {
                    FLOAT vf;
                    FLOAT av = -1.525 - 0.275 * bark[k] - 4.5 + Xtm[k];
                    /* masking function for lower & upper slopes */
                    if (dz < -1)
                        vf = 17 * (dz + 1) - (0.4 * Xtm[k] + 6);
                    else if (dz < 0)
                        vf = (0.4 * Xtm[k] + 6) * dz;
                    else if (dz < 1)
                        vf = (-17 * dz);
                    else
                        vf = -(dz - 1) * (17 - 0.15 * Xtm[k]) - 17;
                    LTtm[j] = psycho_3_add_db(mem, LTtm[j], av + vf);
                }
            }
        }

        /* find every noise label */
        if (noiselabel[k] == NOISE) {
            for (j = 0; j < SUBSIZE; j++) {
                /* figure out how it masks the levels around it */
                FLOAT dz = bark[freq_subset[j]] - bark[k];
                if (dz >= -3.0 && dz < 8.0) {
                    FLOAT vf;
                    FLOAT av = -1.525 - 0.175 * bark[k] - 0.5 + Xnm[k];
                    /* masking function for lower & upper slopes */
                    if (dz < -1)
                        vf = 17 * (dz + 1) - (0.4 * Xnm[k] + 6);
                    else if (dz < 0)
                        vf = (0.4 * Xnm[k] + 6) * dz;
                    else if (dz < 1)
                        vf = (-17 * dz);
                    else
                        vf = -(dz - 1) * (17 - 0.15 * Xnm[k]) - 17;
                    LTnm[j] = psycho_3_add_db(mem, LTnm[j], av + vf);
                }
            }
        }
    }

    /* ISO11172 D.1 Step 7 Calculate the global masking threhold */
    for (i = 0; i < SUBSIZE; i++) {
        LTg[i] = psycho_3_add_db(mem, LTnm[i], LTtm[i]);
        if (bit_rate < 96)
            LTg[i] = psycho_3_add_db(mem, ath[freq_subset[i]], LTg[i]);
        else
            LTg[i] = psycho_3_add_db(mem, ath[freq_subset[i]] - 12.0, LTg[i]);
    }
}


/* Find the minimum LTg for each subband. ISO11172 Sec D.1 Step 8 */
static void psycho_3_minimummasking(FLOAT * LTg, FLOAT * LTmin, int *freq_subset)
{
    int i;

    for (i = 0; i < SBLIMIT; i++)
        LTmin[i] = 999999.9;

    for (i = 0; i < SUBSIZE; i++) {
        int index = freq_subset[i] >> 4;
        if (LTmin[index] > LTg[i]) {
            LTmin[index] = LTg[i];
        }
    }
}


/* ISO11172 Sect D.1 Step 9
   Calculate the signal-to-mask ratio
   MFC FIXME Feb 2003 for better calling from
   twolame, add a "float SMR[]" array and return it */
static void psycho_3_smr(FLOAT * LTmin, FLOAT * Lsb)
{
    int i;
    for (i = 0; i < SBLIMIT; i++) {
        LTmin[i] = Lsb[i] - LTmin[i];
    }
}


static psycho_3_mem *twolame_psycho_3_init(twolame_options * glopts)
{
    int i;
    int cbase = 0;              /* current base index for the bark range calculation */
    FLOAT sfreq;
    psycho_3_mem *mem;
    int numlines[HBLKSIZE];
    FLOAT cbval[HBLKSIZE];
    int partition[HBLKSIZE];
    int *freq_subset;
    FLOAT *bark, *ath;
    int cbands = 0;
    int *cbandindex;

    mem = (psycho_3_mem *) TWOLAME_MALLOC(sizeof(psycho_3_mem));
    mem->off[0] = mem->off[1] = 256;
    freq_subset = mem->freq_subset;
    bark = mem->bark;
    ath = mem->ath;
    cbandindex = mem->cbandindex;

    /* Initialise the tables for the adding dB */
    psycho_3_init_add_db(mem);

    /* For each spectral line calculate the bark and the ATH (in dB) */
    sfreq = (FLOAT) glopts->samplerate_out;
    for (i = 1; i < HBLKSIZE; i++) {
        FLOAT freq = i * sfreq / BLKSIZE;
        bark[i] = twolame_ath_freq2bark(freq);
        ath[i] = twolame_ath_db(freq, glopts->athlevel);
    }

    {   /* Work out the critical bands Starting from line 0, all lines
           within 1 bark of the starting bark are added to the same
           critical band. When a line is greater by 1.0 of a bark, start a
           new critical band.  */

        cbandindex[0] = 1;
        for (i = 1; i < HBLKSIZE; i++) {
            if ((bark[i] - bark[cbase]) > 1.0) {    /* 1 critical band? 1 bark? */
                /* this frequency line is too different from the starting line, (in terms of the
                   bark distance) so make this spectral line the first member of the next critical
                   band */
                cbase = i;      /* Start the new critical band from this frequency line */
                cbands++;
                cbandindex[cbands] = cbase;
            }
            /* partition[i] tells us which critical band the i'th frequency line is in */
            partition[i] = cbands;
            /* keep a count of how many frequency lines are in each partition */
            numlines[cbands]++;
        }

        cbands++;
        cbandindex[cbands] = 513;   /* Set the top of the last critical band */
        mem->cbands = cbands;   // make a not of the number of cbands

        /* For each crtical band calculate the average bark value cbval [central bark value] */
        for (i = 1; i < HBLKSIZE; i++)
            cbval[partition[i]] += bark[i]; /* sum up all the bark values */
        for (i = 1; i < CBANDS; i++) {
            if (numlines[i] != 0)
                cbval[i] /= numlines[i];    /* divide by the number of values */
            else {
                cbval[i] = 0;   /* this isn't a partition */
            }
        }
    }

    {
        /* For Step6 - For the calculation of individual masking thresholds the spectral lines are
           subsampled i.e. no need to work out the masking for every single spectral line.
           Depending upon which subband the calculation is for, you can skip a number of lines
           There are 16 lines per subband -> 32 * 16 = 512 Subband 0-2 : Every line (3 * 16 = 48
           lines) Subband 3-5 : Every Second line (3 * 16/2 = 24 lines) Subband 6-11 : Every 4th
           line (6 * 16/4 = 24 lines) Subband 12-31 : Every 12th line (20 * 16/8 = 40 lines)

           create this subset of frequencies (freq_subset) */
        int freq_index = 0;
        for (i = 1; i < (3 * 16) + 1; i++)
            freq_subset[freq_index++] = i;
        for (; i < (6 * 16) + 1; i += 2)
            freq_subset[freq_index++] = i;
        for (; i < (12 * 16) + 1; i += 4)
            freq_subset[freq_index++] = i;
        for (; i < (32 * 16) + 1; i += 8)
            freq_subset[freq_index++] = i;
    }

    if (glopts->verbosity > 4) {
        printf("%i critical bands\n", cbands);
        for (i = 0; i < cbands; i++)
            printf("cband %i spectral line index %i\n", i, cbandindex[i]);
        printf("%i Subsampled spectral lines\n", SUBSIZE);
        for (i = 0; i < SUBSIZE; i++)
            printf("%i Spectral line %i Bark %.2f\n", i, freq_subset[i],
                    bark[freq_subset[i]]);
    }

    return (mem);
}


static void psycho_3_dump(int *tonelabel, FLOAT * Xtm, int *noiselabel, FLOAT * Xnm)
{
    int i;
    printf("3 Ton:");
    for (i = 1; i < HAN_SIZE; i++) {
        if (tonelabel[i] == TONE)
            printf("[%i] %3.0f ", i, Xtm[i]);
    }
    printf("\n");

    printf("3 Nos:");
    for (i = 1; i < HAN_SIZE; i++) {
        if (noiselabel[i] == NOISE)
            printf("[%i] %3.0f ", i, Xnm[i]);
    }
    printf("\n");
}


void twolame_psycho_3(twolame_options * glopts, short int buffer[2][1152], FLOAT scale[2][32],
                      FLOAT ltmin[2][32])
{
    psycho_3_mem *mem;
    int nch = glopts->num_channels_out;
    int k, i;
    FLOAT sample[BLKSIZE];

    FLOAT energy[BLKSIZE];
    FLOAT power[HBLKSIZE] = {0};
    FLOAT Xtm[HBLKSIZE], Xnm[HBLKSIZE];
    int tonelabel[HBLKSIZE], noiselabel[HBLKSIZE] = {0};
    FLOAT LTg[HBLKSIZE];
    FLOAT Lsb[SBLIMIT];

    int index_timer=1;

    //////1
    start_elapse_time_psycho_3 = timer_time_ms();
    if (!glopts->p3mem) {
        glopts->p3mem = twolame_psycho_3_init(glopts);
    }
    mem = glopts->p3mem;
    end_elapse_time_psycho_3 = timer_time_ms();
    elapsed_time_psycho_3 [index_timer++] += end_elapse_time_psycho_3 - start_elapse_time_psycho_3;

    for (k = 0; k < nch; k++) {

        //////2
        start_elapse_time_psycho_3 = timer_time_ms();
        int ok = mem->off[k] % 1408;
        for (i = 0; i < 1152; i++) {
            mem->fft_buf[k][ok++] = (FLOAT) buffer[k][i] / SCALE;
            if (ok >= 1408)
                ok = 0;
        }
        end_elapse_time_psycho_3 = timer_time_ms();
        elapsed_time_psycho_3 [index_timer] += end_elapse_time_psycho_3 - start_elapse_time_psycho_3;
        //////3
        start_elapse_time_psycho_3 = timer_time_ms();
        ok = (mem->off[k] + 1216) % 1408;
        for (i = 0; i < BLKSIZE; i++) {
            sample[i] = mem->fft_buf[k][ok++];
            if (ok >= 1408)
                ok = 0;
        }
        end_elapse_time_psycho_3 = timer_time_ms();
        elapsed_time_psycho_3 [index_timer+1] += end_elapse_time_psycho_3 - start_elapse_time_psycho_3;
        //////4
        start_elapse_time_psycho_3 = timer_time_ms();

        mem->off[k] += 1152;
        mem->off[k] %= 1408;

        psycho_3_fft(sample, energy);
        end_elapse_time_psycho_3 = timer_time_ms();
        elapsed_time_psycho_3 [index_timer+2] += end_elapse_time_psycho_3 - start_elapse_time_psycho_3;
        //////5
        start_elapse_time_psycho_3 = timer_time_ms();
        psycho_3_powerdensityspectrum(energy, power);
        end_elapse_time_psycho_3 = timer_time_ms();
        elapsed_time_psycho_3 [index_timer+3] += end_elapse_time_psycho_3 - start_elapse_time_psycho_3;
        //////6
        start_elapse_time_psycho_3 = timer_time_ms();
        psycho_3_spl(Lsb, power, &scale[k][0]);
        end_elapse_time_psycho_3 = timer_time_ms();
        elapsed_time_psycho_3 [index_timer+4] += end_elapse_time_psycho_3 - start_elapse_time_psycho_3;
        //////7
        start_elapse_time_psycho_3 = timer_time_ms();
        psycho_3_tonal_label(mem, power, tonelabel, Xtm);
        end_elapse_time_psycho_3 = timer_time_ms();
        elapsed_time_psycho_3 [index_timer+5] += end_elapse_time_psycho_3 - start_elapse_time_psycho_3;
        //////8
        start_elapse_time_psycho_3 = timer_time_ms();
        psycho_3_noise_label(mem, power, energy, tonelabel, noiselabel, Xnm);
        end_elapse_time_psycho_3 = timer_time_ms();
        elapsed_time_psycho_3 [index_timer+6] += end_elapse_time_psycho_3 - start_elapse_time_psycho_3;
        //////9
        start_elapse_time_psycho_3 = timer_time_ms();
        if (glopts->verbosity > 8)
            psycho_3_dump(tonelabel, Xtm, noiselabel, Xnm);
        end_elapse_time_psycho_3 = timer_time_ms();
        elapsed_time_psycho_3 [index_timer+7] += end_elapse_time_psycho_3 - start_elapse_time_psycho_3;
        //////10
        start_elapse_time_psycho_3 = timer_time_ms();
        psycho_3_decimation(mem->ath, tonelabel, Xtm, noiselabel, Xnm, mem->bark);
        end_elapse_time_psycho_3 = timer_time_ms();
        elapsed_time_psycho_3 [index_timer+8] += end_elapse_time_psycho_3 - start_elapse_time_psycho_3;
        //////11
        start_elapse_time_psycho_3 = timer_time_ms();
        psycho_3_threshold(mem, LTg, tonelabel, Xtm, noiselabel, Xnm, mem->bark, mem->ath,
                           glopts->bitrate / nch, mem->freq_subset);
        end_elapse_time_psycho_3 = timer_time_ms();
        elapsed_time_psycho_3 [index_timer+9] += end_elapse_time_psycho_3 - start_elapse_time_psycho_3;
        //////12
        start_elapse_time_psycho_3 = timer_time_ms();
        psycho_3_minimummasking(LTg, &ltmin[k][0], mem->freq_subset);
        end_elapse_time_psycho_3 = timer_time_ms();
        elapsed_time_psycho_3 [index_timer+10] += end_elapse_time_psycho_3 - start_elapse_time_psycho_3;
        //////13
        start_elapse_time_psycho_3 = timer_time_ms();
        psycho_3_smr(&ltmin[k][0], Lsb);
        end_elapse_time_psycho_3 = timer_time_ms();
        elapsed_time_psycho_3 [index_timer+11] += end_elapse_time_psycho_3 - start_elapse_time_psycho_3;
    }

    //for (int i = 1; i < 14; i++) printf(">>>>> psycho_3 function number %d took %d ms\n", i, (unsigned int) elapsed_time_psycho_3[i]);
}


void twolame_psycho_3_deinit(psycho_3_mem ** mem)
{

    if (mem == NULL || *mem == NULL)
        return;

    TWOLAME_FREE(*mem);
}


// vim:ts=4:sw=4:nowrap:
